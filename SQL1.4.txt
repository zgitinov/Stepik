/* SQL 1.4 Вложенные запросы */
/*
Содержание урока
SQL позволяет создавать вложенные запросы. Вложенный запрос (подзапрос, внутренний запрос) – это запрос внутри другого запроса SQL.

Вложенный запрос используется для выборки данных, которые будут использоваться в условии отбора записей основного запроса. 
Его применяют для:

сравнения выражения с результатом вложенного запроса;
определения того, включено ли выражение в результаты вложенного запроса;
проверки того, выбирает ли запрос определенные строки.
Вложенный запрос имеет следующие компоненты:

ключевое слово SELECT  после которого указываются имена столбцов или выражения (чаще всего список содержит один элемент) ;
ключевое слово FROM и имя таблицы, из которой выбираются данные;
необязательное предложение WHERE;
необязательное предложение GROUP BY:
необязательное предложение HAVING.
Вложенные запросы  могут включаться в WHERE или HAVING так 
(в квадратных скобках указаны необязательные элементы, через | – один из элементов):

WHERE | HAVING выражение оператор_сравнения (вложенный запрос);
WHERE | HAVING выражение, включающее вложенный запрос;
WHERE | HAVING выражение [NOT] IN (вложенный запрос);
WHERE | HAVING выражение  оператор_сравнения  ANY | ALL (вложенный запрос).
Также вложенные запросы могут вставляться в основной запрос после ключевого слова SELECT.
*/

/*
Вложенный запрос, возвращающий одно значение
Вложенный запрос, возвращающий одно значение, может использоваться в условии отбора записей WHERE 
как обычное значение совместно с операциями =, <>, >=, <=, >, <.

Задание:
Вывести информацию (автора, название и цену) о  книгах, цены которых меньше или равны средней цене книг на складе. 
Информацию вывести в отсортированном по убыванию цены виде. Среднее вычислить как среднее по цене книги.
*/

SELECT author, title, price
FROM book
WHERE price <= (
         SELECT AVG(price) 
         FROM book)
ORDER BY price DESC;

/*
Использование вложенного запроса в выражении
Вложенный запрос, возвращающий одно значение, может использоваться в выражениях как обычный операнд, 
например, к нему можно что-то прибавить, вычесть и пр.

Задание:
Вывести информацию (автора, название и цену) о тех книгах, цены которых 
превышают минимальную цену книги на складе не более чем на 150 рублей в отсортированном по возрастанию цены виде.
*/

SELECT author, title, price
FROM book
WHERE (price <= 150 + (SELECT MIN(price) FROM book))
ORDER BY price ASC;

/*
